@page "/customers/{id:guid}"

@inject ICustomersClient CustomersClient
@inject NavigationManager NavigationManager

<div class="h-full flex flex-col bg-background-secondary p-4">
    <div class="flex justify-between items-center bg-background-primary rounded p-4">
        <h3 class="text-xl font-semibold">Customer Details</h3>
        
        <div>
            <button class="bg-background-primary hover:bg-blue-primary p-2 rounded transition duration-300 ease-in-out mr-2" @onclick="@(() => NavigationManager.NavigateTo($"/customers/edit/{Customer.Id}"))" title="Edit Customer">
                <i class="fas fa-pen-to-square"></i> Edit
            </button>
            <button class="bg-background-primary hover:bg-red-primary p-2 rounded transition duration-300 ease-in-out" @onclick="Delete" title="Delete Customer">
                <i class="fas fa-trash-alt"></i> Delete
            </button>
        </div>
    </div>

    <div class="md:flex w-full block overflow-y-auto mt-4">
        <div class="md:w-1/2 p-4 bg-background-primary rounded">
            <h3 class="text-lg font-semibold mb-4">Contact Information</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="id" class="block text-sm font-medium">ID</label>
                    <InputText id="id" @bind-Value="Customer.IdAsString" class="bg-parchment text-background-secondary p-2 mt-1 rounded w-full" disabled />
                </div>
                <div>
                    <label for="email" class="block text-sm font-medium">Email</label>
                    <InputText id="email" @bind-Value="Customer.Email" class="bg-parchment text-background-secondary p-2 mt-1 rounded w-full" disabled />
                </div>
                <div>
                    <label for="firstName" class="block text-sm font-medium">First Name</label>
                    <InputText id="firstName" @bind-Value="Customer.FirstName" class="bg-parchment text-background-secondary p-2 mt-1 rounded w-full" disabled />
                </div>
                <div>
                    <label for="lastName" class="block text-sm font-medium">Last Name</label>
                    <InputText id="lastName" @bind-Value="Customer.LastName" class="bg-parchment text-background-secondary p-2 mt-1 rounded w-full" disabled />
                </div>
                <div>
                    <label for="phoneNumber" class="block text-sm font-medium">Phone Number</label>
                    <InputText id="phoneNumber" @bind-Value="Customer.PhoneNumber" class="bg-parchment text-background-secondary p-2 mt-1 rounded w-full" disabled />
                </div>
            </div>
        </div>
        <div class="md:w-1/2 md:ml-4 mt-4 md:mt-0">
            <div class="p-4 bg-background-primary rounded mb-4">
                <h3 class="text-lg font-semibold mb-4">Shipping Address</h3>
                <AddressDisplay
                    Street="@Customer.ShippingStreet"
                    City="@Customer.ShippingCity"
                    ZipCode="@Customer.ShippingZipCode"
                    Country="@Customer.ShippingCountry"
                    State="@Customer.ShippingState"
                />
            </div>
            <div class="p-4 bg-background-primary rounded">
                <h3 class="text-lg font-semibold mb-4">Billing Address</h3>
                @if (string.IsNullOrWhiteSpace(Customer.BillingStreet))
                {
                    <p class="text-gray-500 italic">Same as shipping address</p>
                }
                else
                {
                    <AddressDisplay
                        Street="@Customer.BillingStreet"
                        City="@Customer.BillingCity"
                        ZipCode="@Customer.BillingZipCode"
                        Country="@Customer.BillingCountry"
                        State="@Customer.BillingState"
                    />
                }
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter]
    public Guid Id { get; set; }
    private CustomerModel Customer { get; set; } = new();

    protected override async Task OnInitializedAsync()
    {
        var customer = await CustomersClient.GetById(Id);

        if (customer is null)
        {
            NavigationManager.NavigateTo("/customers");
        }
        
        Customer = new CustomerModel
        {
            Id = customer!.Id,
            FirstName = customer.FirstName,
            LastName = customer.LastName,
            Email = customer.Email,
            ShippingStreet = customer.ShippingStreet,
            ShippingCity = customer.ShippingCity,
            ShippingZipCode = customer.ShippingZipCode,
            ShippingCountry = customer.ShippingCountry,
            ShippingState = customer.ShippingState,
            PhoneNumber = customer.PhoneNumber,
            IdAsString = customer.Id.ToString(),
            BillingStreet = customer.BillingStreet,
            BillingCity = customer.BillingCity,
            BillingZipCode = customer.BillingZipCode,
            BillingCountry = customer.BillingCountry,
            BillingState = customer.BillingState
        };
    }
    
    private async Task Delete()
    {
        await CustomersClient.Delete(Customer.Id);
        
        NavigationManager.NavigateTo("/customers");
    }
    
    private class CustomerModel
    {
        public Guid Id { get; init; }
        public string FirstName { get; set; } = string.Empty;
        public string LastName { get; set; } = string.Empty;
        public string Email { get; set; } = string.Empty;
        public string ShippingStreet { get; set; } = string.Empty;
        public string ShippingCity { get; set; } = string.Empty;
        public string ShippingZipCode { get; set; } = string.Empty;
        public string ShippingCountry { get; set; } = string.Empty;
        public string? ShippingState { get; set; } = string.Empty;
        public string IdAsString { get; set; } = string.Empty;
        public string PhoneNumber { get; set; } = string.Empty;
        public string? BillingStreet { get; set; } = string.Empty;
        public string? BillingCity { get; set; } = string.Empty;
        public string? BillingZipCode { get; set; } = string.Empty;
        public string? BillingCountry { get; set; } = string.Empty;
        public string? BillingState { get; set; } = string.Empty;
    }
}